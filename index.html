<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freetown PT Tracker</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-sA+4Y7Fyy6TxIx+XBjvOpZ9KJxh67zFntZg5t9XkL5A="
    crossorigin=""
  />

  <!-- Your CSS -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Essential map height to show */
    #map {
      height: 600px;
      width: 100%;
      border: 1px solid #ccc;
      margin-top: 1rem;
      border-radius: 8px;
    }

    /* Modal styles: basic example (merge or replace with your CSS) */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 1.5rem;
      max-width: 400px;
      z-index: 1000;
    }
    .modal[aria-hidden="false"] {
      display: block;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      float: right;
    }
    .modal-trigger {
      margin: 1rem 0;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }

    /* Screen reader only helper */
    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0,0,0,0); border: 0;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <header>
      <h1>üöå Freetown Public Transport Tracker üá∏üá±</h1>
      <button id="locateMeBtn" aria-label="Locate my current location">üìç My Location</button>
      <button id="clearVehiclesBtn" aria-label="Clear all vehicle markers">üßπ Clear Vehicles</button>
    </header>

    <!-- Main content with sidebar and map -->
    <main class="main-content">
      <aside class="sidebar" aria-label="Nearby vehicles and alerts sidebar">
        <h2>Nearby Vehicles & Alerts</h2>

        <section id="etaSection" aria-labelledby="etaHeading">
          <h3 id="etaHeading">Estimated Time of Arrival (ETA)</h3>
          <div id="etaList" class="sidebar-list" role="list">
            <!-- ETA items will be injected here -->
          </div>
        </section>

        <section id="alertSection" aria-labelledby="alertHeading">
          <h3 id="alertHeading">Alerts</h3>
          <div id="alertSidebar" class="sidebar-list" role="list">
            <!-- Alerts will be injected here -->
          </div>
        </section>

        <section class="sidebar-filter-container" aria-label="Filter options">
          <h3>Filters</h3>
          <!-- Filter panel will be injected here by JS -->
        </section>
      </aside>

      <div id="map" role="region" aria-label="Map showing vehicle locations"></div>
    </main>

    <footer>
      <p>Last updated: <time id="lastUpdated" datetime="--">--</time></p>
    </footer>
  </div>

  <!-- üöó Modal Trigger Button -->
  <button
    id="openTrackingModal"
    class="modal-trigger"
    aria-haspopup="dialog"
    aria-controls="trackingModal"
  >
    üöó Start Tracking
  </button>

  <!-- üöó Tracking Modal -->
  <div
    id="trackingModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="trackingModalTitle"
    aria-hidden="true"
  >
    <div class="modal-content">
      <button
        class="modal-close"
        id="closeTrackingModal"
        aria-label="Close tracking modal"
      >&times;</button>
      <h2 id="trackingModalTitle">Start Tracking</h2>
      <form id="trackingForm" autocomplete="off">
        <label for="vehicleId">Vehicle ID:</label>
        <input
          type="text"
          id="vehicleId"
          name="vehicleId"
          required
          autocomplete="off"
          aria-required="true"
          aria-describedby="vehicleIdHelp"
        />
        <small id="vehicleIdHelp" class="sr-only">Enter the vehicle identification number.</small>

        <label for="mode">Mode of Transport:</label>
        <select id="mode" name="mode" required aria-required="true">
          <option value="" disabled selected>--Select--</option>
          <option value="Podapoda">Podapoda</option>
          <option value="Taxi">Taxi</option>
          <option value="Keke">Keke</option>
          <option value="Paratransit Bus">Paratransit Bus</option>
          <option value="Waka Fine Bus">Waka Fine Bus</option>
          <option value="Motorbike">Motorbike</option>
        </select>

        <button type="submit">üìç Start Tracking</button>
      </form>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-oC14d7MZr5CU2+gG4jkGd6pMcW7L+QOcVL02Zj5ZL/0="
    crossorigin=""
    defer
  ></script>

  <!-- Your JS -->
  <script src="script.js" defer></script>

  <script>
    // Minimal modal open/close logic to enable Start Tracking button
    document.addEventListener('DOMContentLoaded', () => {
      const openBtn = document.getElementById('openTrackingModal');
      const closeBtn = document.getElementById('closeTrackingModal');
      const modal = document.getElementById('trackingModal');
      const form = document.getElementById('trackingForm');

      openBtn.addEventListener('click', () => {
        modal.setAttribute('aria-hidden', 'false');
      });

      closeBtn.addEventListener('click', () => {
        modal.setAttribute('aria-hidden', 'true');
      });

      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.setAttribute('aria-hidden', 'true');
        }
      });

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        // Placeholder: handle tracking form submission here
        alert(`Started tracking vehicle ID: ${form.vehicleId.value} with mode: ${form.mode.value}`);
        modal.setAttribute('aria-hidden', 'true');
        form.reset();
      });

      // Clear vehicles button listener (optional, add actual clearing in your script.js)
      const clearBtn = document.getElementById('clearVehiclesBtn');
      clearBtn.addEventListener('click', () => {
        alert('Clear vehicles functionality not yet implemented.');
      });
    });
  </script>
</body>
</html>
